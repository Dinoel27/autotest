<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>3D Model Viewer</title>
    <script src="./dist/mr.js"></script>
    <!-- Load THREE.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- Load GLTFLoader and DRACOLoader from a compatible source -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/examples/js/loaders/DRACOLoader.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/examples/js/loaders/GLTFLoader.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css" />
</head>
<body>

<mr-app>
    <!-- Initialize mr-entity to host all 3D geometry on the web page -->
    <mr-entity data-comp-anchor="type:fixed; label:table;" id="model-container" data-position="0 1.5 -0.75">
        <!-- 3D Models initialized as mr-models -->
        <mr-model src="./models/model1.glb" name="Model 1" data-rotation="0 0 0" id="model-1" visible="true">
            <mr-panel class="info-panel" data-position="0 1 0" visible="false">
                <mr-text class="model-info">Information about Model 1</mr-text>
            </mr-panel>
        </mr-model>
        <mr-model src="./models/model2.glb" name="Model 2" data-rotation="0 0 0" id="model-2" visible="false">
            <mr-panel class="info-panel" data-position="0 1 0" visible="false">
                <mr-text class="model-info">Information about Model 2</mr-text>
            </mr-panel>
        </mr-model>
        <!-- Add more models and panels as needed -->
    </mr-entity>
</mr-app>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Ensure user interaction before audio context is created
        document.body.addEventListener('click', initializeAudioContext, { once: true });

        function initializeAudioContext() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            audioContext.resume();
        }

        // Initialize DRACOLoader and GLTFLoader for Draco-compressed models
        const dracoLoader = new THREE.DRACOLoader();
        dracoLoader.setDecoderPath('https://www.gstatic.com/draco/versioned/decoders/1.4.3/');
        const gltfLoader = new THREE.GLTFLoader();
        gltfLoader.setDRACOLoader(dracoLoader);

        const models = document.querySelectorAll('mr-model');

        // Event listener for model click to display info panel
        models.forEach(model => {
            model.addEventListener('click', () => {
                toggleInfoPanel(model);
            });
        });

        // Function to toggle the visibility of the info panel
        function toggleInfoPanel(model) {
            const infoPanel = model.querySelector('.info-panel');
            const isVisible = infoPanel.getAttribute('visible') === 'true';
            infoPanel.setAttribute('visible', !isVisible);
        }
    });
</script>
</body>
</html>
